<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ambient Ocean</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <!-- Creature classes -->
    <script src="js/fish/Fish.js"></script>
    <script src="js/fish/Manta.js"></script>
    <script src="js/fish/Boid.js"></script>
    <script src="js/fish/Koi.js"></script>
    <script src="js/fish/Eel.js"></script>
    <script src="js/fish/Lobster.js"></script>
    <script src="js/fish/Jellyfish.js"></script>
    <script src="js/fish/Starfish.js"></script>
    <script src="js/fish/Crab.js"></script>
    <script src="js/fish/Shark.js"></script>
    <script src="js/fish/SeaTurtle.js"></script>

    <style>
      /* Simple reset to ensure the canvas fills the screen */
      html, body { 
        margin: 0; 
        padding: 0; 
        overflow: hidden; 
        background-color: #000; 
        width: 100%; 
        height: 100%; 
      }
      canvas { display: block; }

      /* --- UI Controls --- */
      .controls-toggle {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 101;
        background: rgba(0, 40, 60, 0.7);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 10px 15px;
        cursor: pointer;
        font-family: sans-serif;
        font-weight: bold;
      }
      .controls-toggle:hover {
        background: rgba(0, 60, 80, 0.9);
      }

      #controls {
        position: absolute;
        top: 70px; /* Position below the toggle button */
        left: 20px;
        z-index: 100;
        background: rgba(0, 40, 60, 0.7);
        padding: 15px;
        border-radius: 12px;
        color: white;
        font-family: sans-serif;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        width: 280px;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      #controls.hidden {
        opacity: 0;
        transform: translateX(-100%);
        pointer-events: none;
      }
      
      label {
        display: block;
        margin-bottom: 8px;
        font-size: 0.9rem;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: flex;
        justify-content: space-between;
      }

      input[type=range] {
        width: 100%;
        cursor: pointer;
        accent-color: #00d2ff;
        margin-bottom: 15px;
      }
      
      .instruction {
        font-size: 0.75rem;
        color: #ccc;
        margin-top: 15px;
        font-style: italic;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 10px;
      }

      #respawnButton, #copyButton {
        width: 100%;
        padding: 12px;
        color: #002030;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        text-transform: uppercase;
        cursor: pointer;
        margin-top: 10px;
      }
      #respawnButton { background-color: #00d2ff; }
      #copyButton { background-color: #6c757d; }
      #respawnButton:hover { background-color: #6efcff; }
      #copyButton:hover { background-color: #8a939b; }
    </style>
  </head>
  <body>
    
    <div id="ui-container"></div>

    <script>
      // =================================================================
      //  OCEAN ANIMATION SCRIPT
      // =================================================================
      let p5_instance;

      const sketch = (p) => {
          let time = 0;
          let allCreatures = [];
          
          let waterColor1, waterColor2, sandColor;

          // --- UI Controls ---
          const showUI = false; // Master toggle for the entire UI panel
          let creatureOpacity = 75;
          const densityControls = {};
          let uiHtml;

          // --- Config ---
          const creatureFiles = [
            "fish/manta.json", "fish/boid.json", "fish/koi.json", "fish/eel.json", "fish/lobster.json",
            "fish/jellyfish.json", "fish/starfish.json", "fish/crab.json", "fish/shark.json", "fish/seaturtle.json"
          ];
          const creatureData = {};

          // --- Class Factory ---
          const creatureClasses = {
            Manta, Boid, Koi, Eel, Lobster, Jellyfish, Starfish, Crab, Shark, SeaTurtle
          };

          function createCreature(p, data) {
            const CreatureClass = creatureClasses[data.type];
            if (CreatureClass) return new CreatureClass(p, data);
            console.warn(`No class found for type: ${data.type}`);
            return null;
          }

          // --- Spawning Logic ---
          function spawnCreatures() {
              allCreatures = [];
              const screenArea = p.width * p.height;
              const loadedCreatureData = Object.values(creatureData);

              for (const data of loadedCreatureData) {
                  if (data.density) {
                      const slider = densityControls[data.type]?.slider;
                      const currentDensity = slider ? parseFloat(slider.value) : data.density;
                      
                      const numToSpawn = Math.round(screenArea * currentDensity);
                      for (let i = 0; i < numToSpawn; i++) {
                          const newCreature = createCreature(p, data);
                          if (newCreature) allCreatures.push(newCreature);
                      }
                  }
              }
          }

          p.preload = () => {
              if (showUI) {
                  uiHtml = p.loadStrings('toggle.html');
              }
              for (const file of creatureFiles) {
                  const name = file.substring(file.lastIndexOf('/') + 1, file.lastIndexOf('.'));
                  creatureData[name] = p.loadJSON(file);
              }
          };

          p.setup = () => {
              p.createCanvas(p.windowWidth, p.windowHeight);
              p.noStroke();
              
              waterColor1 = p.color(32,178,170,150);
              waterColor2 = p.color(0,255,255,150);
              sandColor   = p.color(194,178,128);

              // --- Initialize UI ---
              if (showUI) {
                  const uiContainer = document.getElementById('ui-container');
                  uiContainer.innerHTML = uiHtml.join('');
                  // The uiManager object is now available from the loaded toggle.html
                  uiManager.initialize(p, creatureData, densityControls, spawnCreatures);
              }
              
              spawnCreatures();
          };

          p.draw = () => {
              if (showUI) {
                  uiManager.updateDisplay();
                  creatureOpacity = parseInt(densityControls['opacity'].slider.value);
              }

              p.background(sandColor);
              
              for (let x=0;x<p.width; x+=20) {
                  for (let y=0;y<p.height; y+=20) {
                      let wn = p.noise(x*0.005,y*0.005,time*0.1);
                      p.fill(p.lerpColor(waterColor1, waterColor2, wn));
                      p.rect(x,y,20,20);
                  }
              }
              
              for (const creature of allCreatures) {
                creature.update(time, allCreatures);
                creature.display(waterColor1, waterColor2, time, creatureOpacity);
              }
              
              for (let x=0;x<p.width; x+=20) {
                  for (let y=0;y<p.height; y+=20) {
                      let cn = p.noise(x*0.02+time*0.3, y*0.02+time*0.3);
                      if (cn>0.65) { p.fill(255,255,200,cn*80); p.rect(x,y,20,20); }
                      
                      if (x%40===0 && y%40===0) {
                          let cl = p.noise(x*0.001+time*0.02,y*0.002+time*0.02);
                          if (cl>0.5) { p.fill(255,255,255,(cl-0.5)*60); p.rect(x,y,40,40); }
                      }
                  }
              }
              
              time += 0.02;
          };

          p.windowResized = () => {
              p.resizeCanvas(p.windowWidth, p.windowHeight);
              spawnCreatures(); // Respawn on resize to adjust numbers
          };

          p.keyPressed = () => {
              if (p.key === '+' || p.key === '=') {
                  for (const key in creatureData) {
                      if(creatureData[key].density) creatureData[key].density *= 1.3;
                  }
              } else if (p.key === '-' || p.key === '_') {
                  for (const key in creatureData) {
                      if(creatureData[key].density) creatureData[key].density /= 1.3;
                  }
              }

              if (showUI) {
                  for (const key in densityControls) {
                      const control = densityControls[key];
                      if (control.slider && creatureData[key]) {
                          control.slider.value = creatureData[key].density;
                      }
                  }
              }
              spawnCreatures();
          };
      };

      // Initialize the p5.js sketch
      p5_instance = new p5(sketch);
    </script>
  </body>
</html>